<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>License Terms</title>
  <style>
    :root{
      --dark-blue:#0b2540;
      --muted:#9aa4b2;
      --accent:#6ee7b7;
      --accent-2:#60a5fa;
      --text:#e6eef8;
      --radius:12px;
      --max-width:1100px;
      --glass-border:rgba(255,255,255,0.04);
      --shadow:0 10px 30px rgba(2,6,23,0.6);
      --transition:220ms cubic-bezier(.2,.9,.3,1);
      --control-height:36px;
      --btn-size:36px;
      --box-height:36px;
    }

    html,body{
      height:100%;
      margin:0;
      font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      background:var(--dark-blue);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .container{
      max-width:var(--max-width);
      margin:36px auto;
      padding:18px;
      display:grid;
      grid-template-columns:320px 1fr;
      gap:20px;
      align-items:start;
    }

    .panel{
      background:var(--dark-blue);
      border-radius:var(--radius);
      padding:18px;
      border:1px solid var(--glass-border);
      box-shadow:var(--shadow);
      min-height:220px;
    }

    .brand{display:flex;gap:12px;align-items:center;margin-bottom:12px;}
    .logo{
      width:64px;height:64px;border-radius:6px;background:linear-gradient(135deg,var(--accent),var(--accent-2));
      display:flex;align-items:center;justify-content:center;font-weight:700;color:#04263b;font-size:20px;box-shadow:0 6px 18px rgba(6,30,50,0.35);
      flex:0 0 64px;
    }

    .left-rows{display:flex;flex-direction:column;gap:10px;margin-top:12px}
    .row{display:flex;gap:10px;align-items:center;}

    .text-box{
      flex:1;min-width:0;padding:8px 10px;border-radius:10px;background:rgba(255,255,255,0.02);
      border:1px solid rgba(255,255,255,0.04);color:var(--text);font-weight:600;font-size:0.92rem;
      user-select:text;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;cursor:text;height:var(--box-height);display:flex;align-items:center;
    }

    .action-btn{width:var(--btn-size);height:var(--btn-size);border-radius:8px;display:inline-flex;align-items:center;justify-content:center;border:none;cursor:pointer;box-shadow:0 8px 20px rgba(6,30,50,0.28);flex:0 0 var(--btn-size);transition:transform var(--transition),box-shadow var(--transition);}
    .copy-btn{background:linear-gradient(180deg,var(--accent),var(--accent-2));color:#04263b;}
    .shop-btn{background:linear-gradient(180deg,var(--accent-2),var(--accent));color:#04263b;text-decoration:none;display:inline-flex;}

    .small-note{font-size:0.84rem;color:var(--muted);margin-top:8px}

    .card{background:var(--dark-blue);border-radius:var(--radius);padding:22px;border:1px solid var(--glass-border);box-shadow:var(--shadow);}

    .card-header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .title{display:flex;flex-direction:column;}
    .controls{display:flex;gap:10px;align-items:center}
    .search{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:6px 10px;border-radius:10px;color:var(--text);min-width:220px;height:var(--control-height);box-sizing:border-box;font-size:0.95rem;}

    .last-updated-box{display:flex;flex-direction:column;justify-content:center;align-items:flex-start;gap:2px;padding:6px 12px;border-radius:10px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.04);color:var(--muted);min-width:160px;height:var(--control-height);box-sizing:border-box;}
    .last-updated-box .label{font-size:0.82rem;color:var(--muted);line-height:1}
    .last-updated-box .date{font-size:0.92rem;color:var(--text);font-weight:600;line-height:1}

    .accordion{margin-top:18px;display:grid;gap:12px}
    .section{border-radius:12px;overflow:visible;border:1px solid rgba(255,255,255,0.03);background:rgba(255,255,255,0.01);}
    .section-header{display:flex;align-items:flex-start;justify-content:space-between;padding:14px 16px;gap:12px;cursor:default;}
    .section-title{display:flex;flex-direction:column}
    .section-title strong{font-size:0.98rem}
    .section-title span{font-size:0.86rem;color:var(--muted)}
    .section-body{padding:12px 18px 18px 18px;color:var(--text);line-height:1.6;max-height:none;overflow:visible;}
    .section-body p{margin:0 0 10px 0;color:#dbe9f8}
    .section-body ul{margin:8px 0 0 1.1rem;color:#dbe9f8}
    .section-body li{margin:6px 0}

    .card-footer{margin-top:18px;color:var(--muted);font-size:0.9rem;display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);font-size:0.85rem;color:var(--muted)}

    .pdf-icon-btn{width:40px;height:40px;border-radius:8px;display:inline-flex;align-items:center;justify-content:center;border:none;cursor:pointer;box-shadow:0 8px 20px rgba(6,30,50,0.28);background:linear-gradient(180deg,var(--accent),var(--accent-2));color:#04263b;}

    @media print{
      body{background:#fff;color:#000}
      .container{max-width:100%;display:block;padding:0}
      .panel{display:none}
      .card{padding:12mm;background:#fff;color:#000;border:none;box-shadow:none}
      .section{page-break-inside:avoid}
      .section-body{max-height:none;overflow:visible;padding-top:12px}
      .controls,.action-btn,.pdf-icon-btn{display:none}
    }

    @media (max-width:920px){
      .container{grid-template-columns:1fr;padding:18px}
      .panel{order:2}
      .card{order:1}
      .text-box{white-space:normal;height:40px}
      .controls{flex-direction:column;align-items:stretch}
      .last-updated-box{width:100%;height:auto;padding:10px}
      .search{width:100%}
    }
  </style>
</head>
<body>
  <!-- Minimal HTML: all visible text is provided by terms.json -->
  <div id="root">
    <div class="container" id="app">
      <aside class="panel" id="panel">
        <div class="brand">
          <div id="logo" class="logo" aria-hidden="true"></div>
          <div>
            <h1 id="panelTitle"></h1>
            <p id="panelSubtitle"></p>
          </div>
        </div>

        <div id="panelMeta" class="meta"></div>

        <div class="left-rows">
          <div class="row">
            <div id="emailBox" class="text-box" title=""></div>
            <button id="copyEmailBtn" class="action-btn copy-btn" aria-label="">
              <!-- icon injected by script -->
            </button>
          </div>

          <div class="row">
            <div id="shopBox" class="text-box" title=""></div>
            <a id="shopBtn" class="action-btn shop-btn" href="#" target="_blank" rel="noopener noreferrer" aria-label="">
              <!-- icon injected by script -->
            </a>
          </div>

          <div id="panelTip" class="small-note"></div>
        </div>
      </aside>

      <main class="card" id="main">
        <div class="card-header">
          <div class="title">
            <h2 id="mainTitle"></h2>
            <p id="mainSubtitle"></p>
          </div>

          <div class="controls">
            <input id="searchInput" class="search" placeholder="" aria-label="Search terms" />
            <div class="last-updated-box" role="status" aria-live="polite">
              <div class="label" id="lastLabel"></div>
              <div class="date" id="lastDate"></div>
            </div>
          </div>
        </div>

        <div id="accordion" class="accordion" aria-live="polite"></div>

        <div class="card-footer">
          <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
            <div id="agreementNote" class="note"></div>
            <div class="pill" id="sourceAttribution"></div>
          </div>

          <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
            <button id="savePdfBtn" class="pdf-icon-btn" aria-label=""></button>
          </div>
        </div>
      </main>
    </div>
  </div>

  <script>
    // index.html contains no visible text; all strings come from terms.json
    const SOURCE = 'terms.json';

    // Elements
    const logoEl = document.getElementById('logo');
    const panelTitleEl = document.getElementById('panelTitle');
    const panelSubtitleEl = document.getElementById('panelSubtitle');
    const panelMetaEl = document.getElementById('panelMeta');
    const panelTipEl = document.getElementById('panelTip');

    const emailBox = document.getElementById('emailBox');
    const copyEmailBtn = document.getElementById('copyEmailBtn');

    const shopBox = document.getElementById('shopBox');
    const shopBtn = document.getElementById('shopBtn');

    const mainTitleEl = document.getElementById('mainTitle');
    const mainSubtitleEl = document.getElementById('mainSubtitle');
    const searchInput = document.getElementById('searchInput');
    const lastLabelEl = document.getElementById('lastLabel');
    const lastDateEl = document.getElementById('lastDate');

    const accordion = document.getElementById('accordion');
    const agreementNoteEl = document.getElementById('agreementNote');
    const sourceAttributionEl = document.getElementById('sourceAttribution');
    const savePdfBtn = document.getElementById('savePdfBtn');

    // Small inline SVG icons
    const ICON_COPY = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M9 9H20V20H9V9Z" stroke="#04263b" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/><path d="M5 15H4C3.44772 15 3 14.5523 3 14V4C3 3.44772 3.44772 3 4 3H14C14.5523 3 15 3.44772 15 4V5" stroke="#04263b" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>';
    const ICON_OPEN = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M14 3h7v7" stroke="#04263b" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/><path d="M10 14L21 3" stroke="#04263b" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/><path d="M21 21H3V3" stroke="#04263b" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>';
    const ICON_PDF = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 2v8" stroke="#04263b" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke="#04263b" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/><path d="M7 10l5 5 5-5" stroke="#04263b" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>';

    // Utility: format date with weekday
    function formatWithWeekday(raw){
      let d = new Date(raw);
      if (isNaN(d)) {
        const tryMonthYear = new Date(raw + ' 1');
        if (!isNaN(tryMonthYear)) d = tryMonthYear;
        else d = new Date();
      }
      return d.toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
    }

    // Build a section element from JSON
    function buildSection(idx, sec){
      const section = document.createElement('section');
      section.className = 'section';
      section.setAttribute('data-index', idx);

      const header = document.createElement('div');
      header.className = 'section-header';

      const titleWrap = document.createElement('div');
      titleWrap.className = 'section-title';
      const strong = document.createElement('strong');
      strong.textContent = sec.title || `Section ${idx+1}`;
      titleWrap.appendChild(strong);

      if (sec.subtitle) {
        const span = document.createElement('span');
        span.textContent = sec.subtitle;
        titleWrap.appendChild(span);
      } else if (typeof sec.body === 'string') {
        const span = document.createElement('span');
        span.textContent = sec.body.length > 120 ? sec.body.slice(0,120) + 'â€¦' : sec.body;
        titleWrap.appendChild(span);
      }

      header.appendChild(titleWrap);
      section.appendChild(header);

      const body = document.createElement('div');
      body.className = 'section-body';

      if (Array.isArray(sec.body)) {
        sec.body.forEach(p => {
          const pEl = document.createElement('p');
          pEl.textContent = p;
          body.appendChild(pEl);
        });
      } else if (sec.body && sec.body.type === 'list' && Array.isArray(sec.body.items)) {
        if (sec.body.intro) {
          const intro = document.createElement('p');
          intro.textContent = sec.body.intro;
          body.appendChild(intro);
        }
        const ul = document.createElement('ul');
        sec.body.items.forEach(it => {
          const li = document.createElement('li');
          li.textContent = it;
          ul.appendChild(li);
        });
        body.appendChild(ul);
      } else if (typeof sec.body === 'string') {
        const pEl = document.createElement('p');
        pEl.textContent = sec.body;
        body.appendChild(pEl);
      } else {
        const pEl = document.createElement('p');
        pEl.textContent = 'No content.';
        body.appendChild(pEl);
      }

      section.appendChild(body);
      return section;
    }

    // Render everything from JSON
    function renderFromJson(data){
      // Brand
      if (data.brand) {
        logoEl.textContent = data.brand.logoText || '';
        panelTitleEl.textContent = data.brand.brandTitle || '';
        panelSubtitleEl.textContent = data.brand.brandSubtitle || '';
        panelMetaEl.textContent = data.brand.meta || '';
        panelTipEl.textContent = data.brand.tip || '';
      }

      // Main UI
      mainTitleEl.textContent = data.title || '';
      mainSubtitleEl.textContent = data.subtitle || '';

      // Last updated
      const rawLast = data.lastUpdated || '';
      lastLabelEl.textContent = (data.ui && data.ui.lastUpdatedLabel) ? data.ui.lastUpdatedLabel : 'Last updated:';
      lastDateEl.textContent = rawLast ? formatWithWeekday(rawLast) : formatWithWeekday(new Date());

      // Contact
      const email = data.contact && data.contact.email ? data.contact.email : '';
      emailBox.textContent = email;
      copyEmailBtn.innerHTML = ICON_COPY;
      copyEmailBtn.title = (data.ui && data.ui.copyEmailTooltip) ? data.ui.copyEmailTooltip : 'Copy email';
      copyEmailBtn.setAttribute('aria-label', copyEmailBtn.title);

      const shop = data.contact && data.contact.shop ? data.contact.shop : '';
      shopBox.textContent = shop;
      shopBtn.innerHTML = ICON_OPEN;
      shopBtn.href = shop || '#';
      shopBtn.title = (data.ui && data.ui.openShopTooltip) ? data.ui.openShopTooltip : 'Open shop in new tab';
      shopBtn.setAttribute('aria-label', shopBtn.title);

      // UI strings
      if (data.ui && data.ui.searchPlaceholder) searchInput.placeholder = data.ui.searchPlaceholder;
      sourceAttributionEl.textContent = (data.ui && data.ui.sourceAttribution) ? data.ui.sourceAttribution : 'Source: terms.json';
      agreementNoteEl.textContent = (data.ui && data.ui.agreementNote) ? data.ui.agreementNote : '';

      // Save PDF button
      savePdfBtn.innerHTML = ICON_PDF;
      savePdfBtn.title = (data.ui && data.ui.savePdfTooltip) ? data.ui.savePdfTooltip : 'Save as PDF';
      savePdfBtn.setAttribute('aria-label', savePdfBtn.title);

      // Sections
      accordion.innerHTML = '';
      if (Array.isArray(data.sections)) {
        data.sections.forEach((s, i) => {
          accordion.appendChild(buildSection(i, s));
        });
      }
    }

    // Fetch JSON and render; index.html contains no visible text itself
    fetch(SOURCE, {cache:'no-store'})
      .then(resp => {
        if (!resp.ok) throw new Error('Failed to load ' + SOURCE);
        return resp.json();
      })
      .then(json => renderFromJson(json))
      .catch(err => {
        // Minimal fallback: show nothing but log error
        console.error(err);
      });

    // Copy email behavior
    copyEmailBtn.addEventListener('click', async () => {
      const text = emailBox.textContent || '';
      try {
        await navigator.clipboard.writeText(text);
        // brief visual feedback
        copyEmailBtn.style.transform = 'translateY(1px)';
        setTimeout(() => copyEmailBtn.style.transform = '', 200);
      } catch {
        // fallback: select text
        const range = document.createRange();
        range.selectNodeContents(emailBox);
        const sel = window.getSelection();
        sel.removeAllRanges();
        sel.addRange(range);
      }
    });

    // Ensure shop button opens in new tab (anchor already has target="_blank")
    shopBtn.addEventListener('click', (e) => {
      // no-op; anchor handles opening in new tab
    });

    // Save as PDF (uses html2pdf if available)
    savePdfBtn.addEventListener('click', () => {
      const card = document.querySelector('.card');
      if (!card) return;
      // Expand all sections visually (they are already visible)
      const filename = (mainTitleEl.textContent || 'terms').replace(/\s+/g,'_').toLowerCase() + '_' + new Date().toISOString().slice(0,10) + '.pdf';
      if (window.html2pdf) {
        const clone = card.cloneNode(true);
        clone.querySelectorAll('.action-btn, .pdf-icon-btn, .controls').forEach(n => n && n.remove());
        clone.querySelectorAll('.section-body').forEach(b => { b.style.maxHeight = 'none'; b.style.overflow = 'visible'; });
        const wrapper = document.createElement('div');
        wrapper.style.padding = '12mm';
        wrapper.style.background = '#fff';
        wrapper.style.color = '#000';
        wrapper.appendChild(clone);
        html2pdf().set({ margin:[12,12,12,12], filename, image:{type:'jpeg',quality:0.95}, html2canvas:{scale:2,useCORS:true}, jsPDF:{unit:'mm',format:'a4',orientation:'portrait'} }).from(wrapper).save();
      } else {
        window.print();
      }
    });

    // Simple search: hide non-matching sections
    searchInput.addEventListener('input', () => {
      const q = searchInput.value.trim().toLowerCase();
      const sections = Array.from(accordion.querySelectorAll('.section'));
      sections.forEach(sec => {
        const title = sec.querySelector('.section-title strong').textContent.toLowerCase();
        const body = sec.querySelector('.section-body').textContent.toLowerCase();
        const match = !q || title.includes(q) || body.includes(q);
        sec.style.display = match ? '' : 'none';
      });
    });
  </script>

  <!-- optional: html2pdf if you want client-side PDF generation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</body>
</html>
