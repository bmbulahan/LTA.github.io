<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>License Terms Agreement</title>
  <style>
    :root{
      --dark-blue: #0b2540;
      --muted: #9aa4b2;
      --accent: #6ee7b7;
      --accent-2: #60a5fa;
      --text: #e6eef8;
      --radius: 14px;
      --max-width: 1100px;
      --glass-border: rgba(255,255,255,0.04);
      --shadow: 0 10px 30px rgba(2,6,23,0.6);
      --transition: 240ms cubic-bezier(.2,.9,.3,1);
    }

    /* Base */
    html,body{
      height:100%;
      margin:0;
      font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      background: var(--dark-blue);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    .container{
      max-width:var(--max-width);
      margin:36px auto;
      padding:18px;
      display:grid;
      grid-template-columns:320px 1fr;
      gap:20px;
      align-items:start;
    }

    /* Left panel */
    .panel{
      background: var(--dark-blue);
      border-radius:var(--radius);
      padding:20px;
      border:1px solid var(--glass-border);
      box-shadow:var(--shadow);
      min-height:220px;
    }
    .brand{display:flex;gap:12px;align-items:center;margin-bottom:12px;}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:700;color:#04263b;font-size:20px;box-shadow:0 6px 18px rgba(6,30,50,0.35);}
    .brand h1{font-size:1.05rem;margin:0}
    .brand p{margin:0;color:var(--muted);font-size:0.9rem}
    .panel .meta{margin-top:12px;color:var(--muted);font-size:0.92rem;line-height:1.45}

    /* Unified row style for email and shop so boxes match */
    .left-rows{display:flex;flex-direction:column;gap:12px;margin-top:14px}
    .row{
      display:flex;
      gap:10px;
      align-items:center;
    }

    /* Text boxes (email and shop) - identical sizing and styling */
    .text-box{
      flex:1;                 /* ensures both boxes take same available width */
      min-width:0;           /* allow truncation on small screens */
      padding:10px 12px;
      border-radius:10px;
      background: rgba(255,255,255,0.02);
      border:1px solid rgba(255,255,255,0.04);
      color:var(--text);
      font-weight:600;
      font-size:0.95rem;
      user-select:text;      /* highlightable */
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
      cursor:text;           /* indicates selectable text, not a link */
    }

    /* Action buttons (copy email and open shop) - same size and alignment */
    .action-btn{
      width:44px;
      height:44px;
      border-radius:10px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      border:none;
      cursor:pointer;
      box-shadow:0 8px 20px rgba(6,30,50,0.35);
      flex:0 0 44px;         /* fixed size */
    }

    .copy-btn{ background: linear-gradient(180deg,var(--accent),var(--accent-2)); color:#04263b; }
    .shop-btn{ background: linear-gradient(180deg,var(--accent-2),var(--accent)); color:#04263b; text-decoration:none; display:inline-flex; }

    .small-note{font-size:0.85rem;color:var(--muted);margin-top:8px}

    /* Main card */
    .card{
      background: var(--dark-blue);
      border-radius:var(--radius);
      padding:22px;
      border:1px solid var(--glass-border);
      box-shadow:var(--shadow);
    }

    .card-header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .title{display:flex;flex-direction:column;}
    .title h2{margin:0;font-size:1.15rem}
    .title p{margin:4px 0 0 0;color:var(--muted);font-size:0.95rem}

    .controls{display:flex;gap:10px;align-items:center}
    .search{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px 10px;border-radius:10px;color:var(--text);min-width:220px;}

    /* Sections always visible */
    .accordion{margin-top:18px;display:grid;gap:12px}
    .section{border-radius:12px;overflow:visible;border:1px solid rgba(255,255,255,0.03);background: rgba(255,255,255,0.01);}
    .section-header{display:flex;align-items:flex-start;justify-content:space-between;padding:14px 16px;gap:12px;cursor:default;}
    .section-title{display:flex;flex-direction:column}
    .section-title strong{font-size:0.98rem}
    .section-title span{font-size:0.86rem;color:var(--muted)}
    .section-body{padding:12px 18px 18px 18px;color:var(--text);line-height:1.6;max-height:none;overflow:visible;}
    .section-body p{margin:0 0 10px 0;color:#dbe9f8}
    .section-body ul{margin:8px 0 0 1.1rem;color:#dbe9f8}
    .section-body li{margin:6px 0}

    .card-footer{margin-top:18px;color:var(--muted);font-size:0.9rem;display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);font-size:0.85rem;color:var(--muted)}

    /* Print styles */
    @media print {
      body{background:#fff;color:#000}
      .container{max-width:100%;display:block;padding:0}
      .panel{display:none}
      .card{padding:12mm;background:#fff;color:#000;border:none;box-shadow:none}
      .section{page-break-inside:avoid}
      .section-body{max-height:none;overflow:visible;padding-top:12px}
      .controls, .action-btn{display:none}
    }

    @media (max-width:920px){
      .container{grid-template-columns:1fr;padding:18px}
      .panel{order:2}
      .card{order:1}
      .text-box{white-space:normal}
    }
  </style>
</head>
<body>
  <div class="container">
    <aside class="panel" aria-labelledby="panel-title">
      <div class="brand">
        <div class="logo" aria-hidden="true">LT</div>
        <div>
          <h1 id="panel-title">License Terms</h1>
          <p>Clear, modern, and easy to update — edit <code>terms.json</code> to change content.</p>
        </div>
      </div>

      <div class="meta">Keep these terms visible to buyers. The email and shop link are selectable and copyable.</div>

      <div class="left-rows">
        <!-- Email row: text box + copy button (same size as shop button) -->
        <div class="row" aria-label="Contact email">
          <div id="emailText" class="text-box" title="Contact email (select or copy)">loading...</div>
          <button id="copyBtn" class="action-btn copy-btn" title="Copy email" aria-label="Copy email">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M9 9H20V20H9V9Z" stroke="#04263b" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M5 15H4C3.44772 15 3 14.5523 3 14V4C3 3.44772 3.44772 3 4 3H14C14.5523 3 15 3.44772 15 4V5" stroke="#04263b" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>

        <!-- Shop row: text box + open-in-new-tab button (same size and aligned) -->
        <div class="row" aria-label="Shop link">
          <div id="shopText" class="text-box" title="Shop URL (select or copy)">https://ko-fi.com/bmbulahan/shop</div>
          <a id="shopBtn" class="action-btn shop-btn" href="https://ko-fi.com/bmbulahan/shop" target="_blank" rel="noopener noreferrer" title="Open shop in new tab" aria-label="Open shop in new tab">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M14 3h7v7" stroke="#04263b" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M10 14L21 3" stroke="#04263b" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M21 21H3V3" stroke="#04263b" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </a>
        </div>

        <div class="small-note">Tip: highlight the email or shop link to copy, or use the copy button for the email.</div>
      </div>
    </aside>

    <main class="card" role="main" aria-labelledby="main-title">
      <div class="card-header">
        <div class="title">
          <h2 id="main-title">License Terms Agreement</h2>
          <p id="subtitle">Read the rules for personal and commercial use</p>
        </div>

        <div class="controls">
          <input id="searchInput" class="search" placeholder="Search terms..." aria-label="Search terms" />
          <div class="pill" id="lastUpdated">Last updated: —</div>
        </div>
      </div>

      <div id="accordion" class="accordion" aria-live="polite">
        <!-- Sections injected here -->
      </div>

      <div class="card-footer">
        <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
          <div class="note">By using items from this shop you agree to these terms.</div>
          <div class="pill" id="sourceAttribution">Source: terms.json</div>
        </div>

        <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
          <button id="savePdfBtn" class="action-btn copy-btn" title="Save as PDF" style="width:auto;padding:8px 12px;border-radius:10px;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true" style="margin-right:8px">
              <path d="M12 2v8" stroke="#04263b" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke="#04263b" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M7 10l5 5 5-5" stroke="#04263b" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Save as PDF
          </button>
        </div>
      </div>
    </main>
  </div>

  <!-- html2pdf library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script>
    const SOURCE = 'terms.json';
    const emailText = document.getElementById('emailText');
    const copyBtn = document.getElementById('copyBtn');
    const shopText = document.getElementById('shopText');
    const shopBtn = document.getElementById('shopBtn');
    const accordion = document.getElementById('accordion');
    const lastUpdatedEl = document.getElementById('lastUpdated');
    const searchInput = document.getElementById('searchInput');
    const savePdfBtn = document.getElementById('savePdfBtn');

    function el(tag, props = {}, ...children){
      const node = document.createElement(tag);
      Object.entries(props).forEach(([k,v]) => {
        if (k === 'class') node.className = v;
        else if (k === 'html') node.innerHTML = v;
        else node.setAttribute(k, v);
      });
      children.forEach(c => { if (typeof c === 'string') node.appendChild(document.createTextNode(c)); else if (c) node.appendChild(c); });
      return node;
    }

    function renderSection(idx, sec){
      const section = el('section', {'class':'section', 'aria-expanded':'true', 'data-index': idx});
      const header = el('div', {'class':'section-header'});
      const title = el('div', {'class':'section-title'});
      title.appendChild(el('strong', {}, sec.title || `Section ${idx+1}`));
      if (sec.subtitle) title.appendChild(el('span', {}, sec.subtitle));
      else if (sec.body && typeof sec.body === 'string') title.appendChild(el('span', {}, sec.body.slice(0,120) + (sec.body.length>120 ? '…' : '')));

      header.appendChild(title);

      const body = el('div', {'class':'section-body', 'id':'body-'+idx});
      if (Array.isArray(sec.body)){
        sec.body.forEach(p => body.appendChild(el('p', {}, p)));
      } else if (sec.body && sec.body.type === 'list' && Array.isArray(sec.body.items)){
        if (sec.body.intro) body.appendChild(el('p', {}, sec.body.intro));
        const ul = el('ul');
        sec.body.items.forEach(it => ul.appendChild(el('li', {}, it)));
        body.appendChild(ul);
      } else if (typeof sec.body === 'string'){
        body.appendChild(el('p', {}, sec.body));
      } else {
        body.appendChild(el('p', {}, 'No content.'));
      }

      section.appendChild(header);
      section.appendChild(body);
      return section;
    }

    function renderTerms(data){
      document.getElementById('main-title').textContent = data.title || 'License Terms Agreement';
      document.getElementById('subtitle').textContent = data.subtitle || 'Read the rules for personal and commercial use';
      lastUpdatedEl.textContent = 'Last updated: ' + (data.lastUpdated || '—');

      const email = data.contact && data.contact.email ? data.contact.email : 'bulahan.belmar@gmail.com';
      emailText.textContent = email;

      const shopFromJson = data.contact && data.contact.shop ? data.contact.shop : 'https://ko-fi.com/bmbulahan/shop';
      shopText.textContent = shopFromJson;
      shopBtn.href = shopFromJson;

      accordion.innerHTML = '';
      if (Array.isArray(data.sections)){
        data.sections.forEach((s, i) => accordion.appendChild(renderSection(i, s)));
      } else {
        accordion.appendChild(el('div', {}, 'No sections found in terms.json'));
      }
    }

    // Load JSON
    fetch(SOURCE, {cache:'no-store'})
      .then(resp => {
        if (!resp.ok) throw new Error('Network response not ok');
        return resp.json();
      })
      .then(json => renderTerms(json))
      .catch(err => {
        // fallback defaults
        emailText.textContent = 'bulahan.belmar@gmail.com';
        shopText.textContent = 'https://ko-fi.com/bmbulahan/shop';
        shopBtn.href = 'https://ko-fi.com/bmbulahan/shop';
        accordion.innerHTML = '';
        accordion.appendChild(el('div', {}, 'Could not load terms.json. Edit terms.json in the same folder and reload.'));
        console.error(err);
      });

    // Copy email to clipboard
    copyBtn.addEventListener('click', async () => {
      const text = emailText.textContent || '';
      try {
        await navigator.clipboard.writeText(text);
        // visual feedback: temporarily change button content
        copyBtn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M20 6L9 17l-5-5" stroke="#04263b" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>';
        setTimeout(() => {
          copyBtn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M9 9H20V20H9V9Z" stroke="#04263b" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/><path d="M5 15H4C3.44772 15 3 14.5523 3 14V4C3 3.44772 3.44772 3 4 3H14C14.5523 3 15 3.44772 15 4V5" stroke="#04263b" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>';
        }, 1200);
      } catch (e) {
        // fallback: select text for manual copy
        const range = document.createRange();
        range.selectNodeContents(emailText);
        const sel = window.getSelection();
        sel.removeAllRanges();
        sel.addRange(range);
      }
    });

    // Search filter
    searchInput.addEventListener('input', () => {
      const q = searchInput.value.trim().toLowerCase();
      const sections = Array.from(accordion.querySelectorAll('.section'));
      sections.forEach(sec => {
        const title = sec.querySelector('.section-title strong').textContent.toLowerCase();
        const body = sec.querySelector('.section-body').textContent.toLowerCase();
        const match = !q || title.includes(q) || body.includes(q);
        sec.style.display = match ? '' : 'none';
      });
    });

    // Save as PDF
    savePdfBtn.addEventListener('click', async () => {
      const card = document.querySelector('.card');
      if (!card) return;
      const title = (document.getElementById('main-title').textContent || 'terms').replace(/\s+/g, '_').toLowerCase();
      const date = new Date().toISOString().slice(0,10);
      const filename = `${title}_${date}.pdf`;
      const opt = {
        margin: [12,12,12,12],
        filename,
        image: { type: 'jpeg', quality: 0.95 },
        html2canvas: { scale: 2, useCORS: true, logging: false },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
      };
      const clone = card.cloneNode(true);
      clone.querySelectorAll('.controls, .action-btn').forEach(n => n && n.remove());
      clone.querySelectorAll('.section-body').forEach(b => { b.style.maxHeight = 'none'; b.style.overflow = 'visible'; });
      const wrapper = document.createElement('div');
      wrapper.style.padding = '12mm';
      wrapper.style.background = '#ffffff';
      wrapper.style.color = '#000';
      wrapper.appendChild(clone);
      try {
        html2pdf().set(opt).from(wrapper).save();
      } catch (err) {
        console.error('PDF generation failed', err);
        window.print();
      }
    });
  </script>
</body>
</html>
