<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>License Terms Agreement</title>
  <style>
    :root{
      --dark-blue: #0b2540; /* unified single background color */
      --muted: #9aa4b2;
      --accent: #6ee7b7;
      --accent-2: #60a5fa;
      --text: #e6eef8;
      --radius: 14px;
      --max-width: 1100px;
      --pad: 22px;
      --glass-border: rgba(255,255,255,0.04);
      --shadow: 0 10px 30px rgba(2,6,23,0.6);
      --transition: 240ms cubic-bezier(.2,.9,.3,1);
    }

    /* Base */
    html,body{
      height:100%;
      margin:0;
      font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: var(--dark-blue);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    a{color:inherit}
    .container{
      max-width:var(--max-width);
      margin:36px auto;
      padding:18px;
      display:grid;
      grid-template-columns:320px 1fr;
      gap:20px;
      align-items:start;
    }

    /* Left panel */
    .panel{
      background: var(--dark-blue);
      border-radius:var(--radius);
      padding:20px;
      border:1px solid var(--glass-border);
      box-shadow:var(--shadow);
      min-height:220px;
    }
    .brand{
      display:flex;gap:12px;align-items:center;margin-bottom:12px;
    }
    .logo{
      width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:700;color:#04263b;font-size:20px;box-shadow:0 6px 18px rgba(6,30,50,0.35);
    }
    .brand h1{font-size:1.05rem;margin:0}
    .brand p{margin:0;color:var(--muted);font-size:0.9rem}
    .panel .meta{margin-top:12px;color:var(--muted);font-size:0.92rem;line-height:1.45}

    .email-row{display:flex;gap:10px;align-items:center;margin-top:16px}
    .email-button{
      display:inline-flex;align-items:center;gap:10px;padding:10px 12px;border-radius:10px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.04);color:var(--text);font-weight:600;font-size:0.95rem;user-select:text;cursor:text; /* cursor text to indicate non-clickable body */
    }
    .email-icon{width:18px;height:18px;opacity:0.95;display:inline-block}
    .copy-btn{
      display:inline-flex;align-items:center;justify-content:center;width:38px;height:38px;border-radius:10px;background:linear-gradient(180deg,var(--accent),var(--accent-2));color:#04263b;font-weight:700;border:none;cursor:pointer;box-shadow:0 8px 20px rgba(6,30,50,0.35);
    }
    .copy-btn:active{transform:translateY(1px)}
    .small-note{font-size:0.85rem;color:var(--muted);margin-top:10px}

    /* Main card */
    .card{
      background: var(--dark-blue);
      border-radius:var(--radius);
      padding:22px;
      border:1px solid var(--glass-border);
      box-shadow:var(--shadow);
    }

    .card-header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .title{display:flex;flex-direction:column;}
    .title h2{margin:0;font-size:1.15rem}
    .title p{margin:4px 0 0 0;color:var(--muted);font-size:0.95rem}

    .controls{display:flex;gap:10px;align-items:center}
    .search{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px 10px;border-radius:10px;color:var(--text);min-width:220px;}

    /* Accordion (all sections visible and non-collapsible) */
    .accordion{margin-top:18px;display:grid;gap:12px}
    .section{
      border-radius:12px;overflow:visible;border:1px solid rgba(255,255,255,0.03);background: rgba(255,255,255,0.01);
      transition:transform var(--transition), box-shadow var(--transition);
    }
    .section[aria-expanded="true"]{box-shadow:0 18px 40px rgba(2,6,23,0.6);transform:none}
    .section-header{
      display:flex;align-items:flex-start;justify-content:space-between;padding:14px 16px;gap:12px;
      cursor:default; /* not clickable */
    }
    .section-title{display:flex;flex-direction:column}
    .section-title strong{font-size:0.98rem}
    .section-title span{font-size:0.86rem;color:var(--muted)}
    .chev{display:none} /* hide chevron since sections are not collapsible */

    /* bodies always visible */
    .section-body{
      padding:12px 18px 18px 18px;color:var(--text);line-height:1.6;max-height:none;overflow:visible;
    }

    .section-body p{margin:0 0 10px 0;color:#dbe9f8}
    .section-body ul{margin:8px 0 0 1.1rem;color:#dbe9f8}
    .section-body li{margin:6px 0}

    .card-footer{margin-top:18px;color:var(--muted);font-size:0.9rem;display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}

    .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);font-size:0.85rem;color:var(--muted)}
    .fade-in{animation:fadeIn .6s ease both}
    @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}

    /* Print styles: keep it clean and readable */
    @media print {
      body{background: #fff; color:#000}
      .container{max-width:100%;display:block;padding:0}
      .panel{display:none}
      .card{padding:12mm;background:#fff;color:#000;border:none;box-shadow:none}
      .section{page-break-inside:avoid}
      .section-body{max-height:none;overflow:visible;padding-top:12px}
      .controls, .copy-btn, .email-row .copy-btn, .chev{display:none}
    }

    @media (max-width:920px){
      .container{grid-template-columns:1fr; padding:18px}
      .panel{order:2}
      .card{order:1}
    }
  </style>
</head>
<body>
  <div class="container fade-in">
    <aside class="panel" aria-labelledby="panel-title">
      <div class="brand">
        <div class="logo" aria-hidden="true">LT</div>
        <div>
          <h1 id="panel-title">License Terms</h1>
          <p>Clear, modern, and easy to update — edit <code>terms.json</code> to change content.</p>
        </div>
      </div>

      <div class="meta">
        Keep these terms visible to buyers. The email is selectable and copyable.
      </div>

      <div class="email-row" style="margin-top:14px">
        <!-- Email displayed as selectable text (not a clickable link) -->
        <div id="emailLink" class="email-button" title="Contact email (select or copy)">
          <svg class="email-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path d="M3 6.5C3 5.67157 3.67157 5 4.5 5H19.5C20.3284 5 21 5.67157 21 6.5V17.5C21 18.3284 20.3284 19 19.5 19H4.5C3.67157 19 3 18.3284 3 17.5V6.5Z" stroke="rgba(255,255,255,0.9)" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M21 6.5L12 12.5L3 6.5" stroke="rgba(255,255,255,0.9)" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span id="emailText">loading...</span>
        </div>

        <button id="copyBtn" class="copy-btn" title="Copy email">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M9 9H20V20H9V9Z" stroke="#04263b" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M5 15H4C3.44772 15 3 14.5523 3 14V4C3 3.44772 3.44772 3 4 3H14C14.5523 3 15 3.44772 15 4V5" stroke="#04263b" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>

      <div class="small-note">Tip: highlight the email to copy, or use the copy button.</div>
    </aside>

    <main class="card" role="main" aria-labelledby="main-title">
      <div class="card-header">
        <div class="title">
          <h2 id="main-title">License Terms Agreement</h2>
          <p id="subtitle">Read the rules for personal and commercial use</p>
        </div>

        <div class="controls">
          <input id="searchInput" class="search" placeholder="Search terms..." aria-label="Search terms" />
          <div class="pill" id="lastUpdated">Last updated: —</div>
        </div>
      </div>

      <div id="accordion" class="accordion" aria-live="polite" style="margin-top:12px">
        <!-- Sections injected here (all visible, non-collapsible) -->
      </div>

      <div class="card-footer">
        <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
          <div class="note">By using items from this shop you agree to these terms.</div>
          <div class="pill" id="sourceAttribution">Source: terms.json</div>
        </div>

        <!-- Save PDF control only (print button removed) -->
        <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
          <button id="savePdfBtn" class="copy-btn" title="Save as PDF" style="background:linear-gradient(180deg,var(--accent),var(--accent-2));color:#04263b;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M12 2v8" stroke="#04263b" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke="#04263b" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M7 10l5 5 5-5" stroke="#04263b" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
      </div>
    </main>
  </div>

  <!-- html2pdf library for client-side PDF generation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js" integrity="sha512-YcsIPb0bq3qkq3kq3kq3kq3kq3kq3kq3kq3kq3kq3kq3kq3kq3kq3kq3kq3kq3kq3kq3kq3kq3kq==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script>
    const SOURCE = 'terms.json';
    const emailText = document.getElementById('emailText');
    const copyBtn = document.getElementById('copyBtn');
    const accordion = document.getElementById('accordion');
    const lastUpdatedEl = document.getElementById('lastUpdated');
    const searchInput = document.getElementById('searchInput');
    const savePdfBtn = document.getElementById('savePdfBtn');

    function el(tag, props = {}, ...children){
      const node = document.createElement(tag);
      Object.entries(props).forEach(([k,v]) => {
        if (k === 'class') node.className = v;
        else if (k === 'html') node.innerHTML = v;
        else node.setAttribute(k, v);
      });
      children.forEach(c => { if (typeof c === 'string') node.appendChild(document.createTextNode(c)); else if (c) node.appendChild(c); });
      return node;
    }

    // Render a section (non-collapsible, expanded by default)
    function renderSection(idx, sec){
      const section = el('section', {'class':'section', 'aria-expanded':'true', 'data-index': idx});
      const header = el('div', {'class':'section-header'});
      const title = el('div', {'class':'section-title'});
      title.appendChild(el('strong', {}, sec.title || `Section ${idx+1}`));
      if (sec.subtitle) title.appendChild(el('span', {}, sec.subtitle));
      else if (sec.body && typeof sec.body === 'string') title.appendChild(el('span', {}, sec.body.slice(0,120) + (sec.body.length>120 ? '…' : '')));

      header.appendChild(title);

      const body = el('div', {'class':'section-body', 'id':'body-'+idx});
      if (Array.isArray(sec.body)){
        sec.body.forEach(p => body.appendChild(el('p', {}, p)));
      } else if (sec.body && sec.body.type === 'list' && Array.isArray(sec.body.items)){
        if (sec.body.intro) body.appendChild(el('p', {}, sec.body.intro));
        const ul = el('ul');
        sec.body.items.forEach(it => ul.appendChild(el('li', {}, it)));
        body.appendChild(ul);
      } else if (typeof sec.body === 'string'){
        body.appendChild(el('p', {}, sec.body));
      } else {
        body.appendChild(el('p', {}, 'No content.'));
      }

      section.appendChild(header);
      section.appendChild(body);
      return section;
    }

    function renderTerms(data){
      document.getElementById('main-title').textContent = data.title || 'License Terms Agreement';
      document.getElementById('subtitle').textContent = data.subtitle || 'Read the rules for personal and commercial use';
      lastUpdatedEl.textContent = 'Last updated: ' + (data.lastUpdated || '—');

      const email = data.contact && data.contact.email ? data.contact.email : '';
      if (email){
        emailText.textContent = email;
      } else {
        emailText.textContent = 'contact';
      }

      accordion.innerHTML = '';
      if (Array.isArray(data.sections)){
        data.sections.forEach((s, i) => {
          accordion.appendChild(renderSection(i, s));
        });
      } else {
        accordion.appendChild(el('div', {}, 'No sections found in terms.json'));
      }
    }

    // Fetch JSON and render
    fetch(SOURCE, {cache:'no-store'})
      .then(resp => {
        if (!resp.ok) throw new Error('Network response not ok');
        return resp.json();
      })
      .then(json => renderTerms(json))
      .catch(err => {
        accordion.innerHTML = '';
        accordion.appendChild(el('div', {}, 'Could not load terms.json. If you opened the file directly, run a local server or embed the JSON into the page.'));
        console.error(err);
      });

    // Copy email
    copyBtn.addEventListener('click', async () => {
      const text = emailText.textContent || '';
      try {
        await navigator.clipboard.writeText(text);
        copyBtn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M20 6L9 17l-5-5" stroke="#04263b" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>';
        setTimeout(() => {
          copyBtn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M9 9H20V20H9V9Z" stroke="#04263b" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><path d="M5 15H4C3.44772 15 3 14.5523 3 14V4C3 3.44772 3.44772 3 4 3H14C14.5523 3 15 3.44772 15 4V5" stroke="#04263b" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>';
        }, 1400);
      } catch (e) {
        const range = document.createRange();
        range.selectNodeContents(emailText);
        const sel = window.getSelection();
        sel.removeAllRanges();
        sel.addRange(range);
      }
    });

    // Search filter (hides non-matching sections)
    searchInput.addEventListener('input', () => {
      const q = searchInput.value.trim().toLowerCase();
      const sections = Array.from(accordion.querySelectorAll('.section'));
      sections.forEach(sec => {
        const title = sec.querySelector('.section-title strong').textContent.toLowerCase();
        const body = sec.querySelector('.section-body').textContent.toLowerCase();
        const match = !q || title.includes(q) || body.includes(q);
        sec.style.display = match ? '' : 'none';
      });
    });

    // Save as PDF using html2pdf (all content visible)
    savePdfBtn.addEventListener('click', async () => {
      const card = document.querySelector('.card');
      if (!card) return;

      const title = (document.getElementById('main-title').textContent || 'terms').replace(/\s+/g, '_').toLowerCase();
      const date = new Date().toISOString().slice(0,10);
      const filename = `${title}_${date}.pdf`;

      const opt = {
        margin:       [12, 12, 12, 12],
        filename:     filename,
        image:        { type: 'jpeg', quality: 0.95 },
        html2canvas:  { scale: 2, useCORS: true, logging: false },
        jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
      };

      const clone = card.cloneNode(true);
      // Remove interactive controls from clone
      clone.querySelectorAll('.controls, .copy-btn, .email-row .copy-btn').forEach(n => n && n.remove());
      clone.querySelectorAll('.section-body').forEach(b => { b.style.maxHeight = 'none'; b.style.overflow = 'visible'; });

      const wrapper = document.createElement('div');
      wrapper.style.padding = '12mm';
      wrapper.style.background = '#ffffff';
      wrapper.style.color = '#000';
      wrapper.appendChild(clone);

      try {
        html2pdf().set(opt).from(wrapper).save();
      } catch (err) {
        console.error('PDF generation failed', err);
        window.print();
      }
    });
  </script>
</body>
</html>
